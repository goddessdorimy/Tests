<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <title>Formulario de Pedido de Tartas</title>

    <style>

        body { font-family: Arial, sans-serif; padding: 20px; }

        #tabla-pedido { width: 100%; border-collapse: collapse; margin-bottom: 20px; }

        #tabla-pedido th, #tabla-pedido td { border: 1px solid #ccc; padding: 8px; text-align: left; }

        .item-row select { width: 90%; padding: 5px; }

        .item-row input[type="radio"] { margin-right: 5px; }

        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; }

        .submit-btn { margin-top: 20px; }

    </style>

</head>

<body>


    <h1>üìù Tu Pedido Personalizado</h1>


    <label for="cliente">Nombre del Cliente:</label>

    <input type="text" id="cliente" required style="width: 300px; padding: 8px; margin-bottom: 15px;"><br>


    <table id="tabla-pedido">

        <thead>

            <tr>

                <th>Item</th>

                <th>Cantidad</th>

                <th>Con Huevo</th>

                <th>Vegano</th>

                <th>Acci√≥n</th>

            </tr>

        </thead>

        <tbody id="cuerpo-pedido">

            </tbody>

    </table>


    <button type="button" onclick="agregarFilaItem()">+ A√±adir Otra Tarta</button>

    <br>


    <button type="submit" class="submit-btn" onclick="enviarDatosMake()">Enviar Pedido a Make.com</button>


    <script>

        // *** REEMPLAZA ESTA URL CON LA URL DE TU CUSTOM WEBHOOK DE MAKE.COM ***

        const MAKE_WEBHOOK_URL = "LA_URL_DE_TU_WEBHOOK_DE_MAKE_AQUI";


        const productos = ["Tarta Vainilla", "Tarta Chocolate", "Tarta Fresa", "Tarta Manzana"];


        // 1. FUNCI√ìN PARA A√ëADIR UNA FILA DE ITEM

        function agregarFilaItem() {

            const cuerpo = document.getElementById('cuerpo-pedido');

            const newRow = cuerpo.insertRow();

            newRow.className = 'item-row';

           

            // Columna 1: Producto (Dropdown)

            let cell1 = newRow.insertCell(0);

            let selectProducto = document.createElement('select');

            selectProducto.name = 'producto';

            productos.forEach(prod => {

                let option = document.createElement('option');

                option.value = prod;

                option.textContent = prod;

                selectProducto.appendChild(option);

            });

            cell1.appendChild(selectProducto);


            // Columna 2: Cantidad (Dropdown)

            let cell2 = newRow.insertCell(1);

            let selectCantidad = document.createElement('select');

            selectCantidad.name = 'cantidad';

            for (let i = 1; i <= 10; i++) {

                let option = document.createElement('option');

                option.value = i;

                option.textContent = i;

                selectCantidad.appendChild(option);

            }

            cell2.appendChild(selectCantidad);

           

            // Columna 3: Con Huevo (Radio Buttons)

            let cell3 = newRow.insertCell(2);

            cell3.innerHTML = `

                <input type="radio" name="huevo_${Date.now()}" value="Si" required> Si

                <input type="radio" name="huevo_${Date.now()}" value="No" checked> No

            `;


            // Columna 4: Vegano (Radio Buttons)

            let cell4 = newRow.insertCell(3);

            cell4.innerHTML = `

                <input type="radio" name="vegano_${Date.now()}" value="Si" checked> Si

                <input type="radio" name="vegano_${Date.now()}" value="No" required> No

            `;

           

            // Columna 5: Acci√≥n (Bot√≥n Eliminar)

            let cell5 = newRow.insertCell(4);

            let deleteButton = document.createElement('button');

            deleteButton.textContent = 'X';

            deleteButton.onclick = function() {

                cuerpo.removeChild(newRow);

            };

            cell5.appendChild(deleteButton);

        }


        // Aseguramos que haya al menos una fila al cargar

        agregarFilaItem();



        // 2. FUNCI√ìN PARA ENVIAR DATOS A MAKE.COM

        async function enviarDatosMake() {

            if (MAKE_WEBHOOK_URL === "LA_URL_DE_TU_WEBHOOK_DE_MAKE_AQUI") {

                 alert("¬°ERROR! Por favor, reemplaza la constante MAKE_WEBHOOK_URL en el c√≥digo JS con tu URL de Webhook de Make.com.");

                 return;

            }

           

            const nombreCliente = document.getElementById('cliente').value.trim();

            if (!nombreCliente) {

                alert("Por favor, introduce el nombre del cliente.");

                return;

            }

           

            const filas = document.querySelectorAll('#cuerpo-pedido .item-row');

            if (filas.length === 0) {

                alert("Debes a√±adir al menos una tarta al pedido.");

                return;

            }


            const itemsPedido = [];

            filas.forEach(fila => {

                const producto = fila.querySelector('select[name="producto"]').value;

                const cantidad = fila.querySelector('select[name="cantidad"]').value;

                const huevo = fila.querySelector('input[name^="huevo"]:checked').value;

                const vegano = fila.querySelector('input[name^="vegano"]:checked').value;


                itemsPedido.push({

                    producto: producto,

                    cantidad: parseInt(cantidad),

                    con_huevo: huevo,

                    es_vegano: vegano

                });

            });


            // Objeto final que se enviar√° a Make.com

            const payload = {

                cliente: nombreCliente,

                timestamp: new Date().toISOString(),

                items: itemsPedido // ¬°Esta es la lista de tartas que procesar√° Make.com!

            };


            console.log("Datos a enviar:", payload);

           

            // Env√≠o de datos a Make.com usando Fetch API

            try {

                const response = await fetch(MAKE_WEBHOOK_URL, {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json'

                    },

                    body: JSON.stringify(payload)

                });

               

                if (response.ok) {

                    alert('‚úÖ ¬°Pedido enviado correctamente a Make.com!');

                    // Opcional: limpiar el formulario

                    document.getElementById('cliente').value = '';

                    document.getElementById('cuerpo-pedido').innerHTML = '';

                    agregarFilaItem();

                } else {

                    alert('‚ùå Error al enviar el pedido a Make.com. Estado: ' + response.status);

                }

            } catch (error) {

                alert('‚ùå Error de conexi√≥n: ' + error.message);

            }

        }

    </script>


</body>

</html>

