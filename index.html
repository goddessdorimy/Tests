<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Cake Order Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', sans-serif; }
      .form-input {
        @apply block w-full px-4 py-2 text-slate-700 bg-white border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition duration-150 ease-in-out;
      }
      .form-radio {
        @apply h-4 w-4 text-sky-600 border-slate-300 focus:ring-sky-500;
      }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root">
        <!-- Header -->
        <header class="bg-white shadow-sm">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Happy Cake Order Form</h1>
            <p class="mt-1 text-slate-500">Please fill out the details below to place your order.</p>
          </div>
        </header>

        <!-- Form -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <form id="order-form" class="space-y-8">
                <!-- Order Details Card -->
                <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                    <h2 class="text-xl font-semibold text-slate-800 border-b border-slate-200 pb-4 mb-6">Order Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="orderDate" class="block text-sm font-medium text-slate-600 mb-1">Date of Order</label>
                            <input type="date" id="orderDate" name="orderDate" class="form-input">
                        </div>
                        <div>
                           <label for="doNumber" class="block text-sm font-medium text-slate-600 mb-1">DO# Number</label>
                           <input type="text" id="doNumber" name="doNumber" placeholder="e.g., 12345" class="form-input" required>
                        </div>
                        <div>
                            <label for="orderId" class="block text-sm font-medium text-slate-600 mb-1">Order ID</label>
                            <input type="text" id="orderId" name="orderId" placeholder="e.g., HC-67890" class="form-input" required>
                        </div>
                    </div>
                </section>

                <!-- Recipient & Delivery Information -->
                <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                    <h2 class="text-xl font-semibold text-slate-800 border-b border-slate-200 pb-4 mb-6">Recipient & Delivery Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="recipientName" class="block text-sm font-medium text-slate-600 mb-1">Name of Recipient</label>
                            <input type="text" id="recipientName" name="recipientName" placeholder="John Doe" class="form-input">
                        </div>
                        <div>
                           <label for="contactNumber" class="block text-sm font-medium text-slate-600 mb-1">Contact Number</label>
                           <input type="tel" id="contactNumber" name="contactNumber" placeholder="012-345 6789" class="form-input">
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="deliveryAddress" class="block text-sm font-medium text-slate-600 mb-1">Delivery Address</label>
                        <textarea id="deliveryAddress" name="deliveryAddress" rows="3" placeholder="123 Happy Lane, Cakeville, 50200" class="form-input" required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div>
                           <label for="deliveryDate" class="block text-sm font-medium text-slate-600 mb-1">Date of Delivery</label>
                           <input type="date" id="deliveryDate" name="deliveryDate" class="form-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-2">Time Slot of Delivery</label>
                            <div id="deliveryTimeSlot-group" class="space-y-2"></div>
                            <input type="text" id="otherTimeSlot" name="otherTimeSlot" placeholder="Please specify time" class="form-input mt-2 hidden">
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="deliveryRemarks" class="block text-sm font-medium text-slate-600 mb-1">Delivery Remarks</label>
                        <textarea id="deliveryRemarks" name="deliveryRemarks" rows="2" placeholder="e.g., Call upon arrival, leave at guardhouse if no one answers." class="form-input"></textarea>
                    </div>
                </section>
                
                <!-- Your Orders -->
                <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                  <h2 class="text-xl font-semibold text-slate-800 border-b border-slate-200 pb-4 mb-6">Your Orders</h2>
                  <div id="order-items-container" class="space-y-6"></div>
                  <div class="mt-6 flex justify-start">
                    <button type="button" id="add-order-item-btn" class="bg-sky-100 text-sky-700 hover:bg-sky-200 font-semibold py-2 px-4 rounded-lg transition-colors duration-200">
                      + Add Another Cake
                    </button>
                  </div>
                </section>

                <!-- Final Details -->
                <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                  <h2 class="text-xl font-semibold text-slate-800 border-b border-slate-200 pb-4 mb-6">Final Details</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label for="generalRemarks" class="block text-sm font-medium text-slate-600 mb-1">General Remarks</label>
                      <textarea id="generalRemarks" name="generalRemarks" rows="3" placeholder="Any other notes for the entire order." class="form-input"></textarea>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">How did you hear about Happy Cake?</label>
                      <div id="source-group" class="space-y-2"></div>
                      <input type="text" id="otherSource" name="otherSource" placeholder="Please specify" class="form-input mt-2 hidden">
                    </div>
                  </div>
                </section>

                <!-- Submit Button -->
                <div class="flex justify-end pt-4">
                  <button type="submit" id="submit-btn" class="bg-sky-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-all duration-200">
                    Submit Order
                  </button>
                   <p id="submission-status" class="ml-4 flex items-center text-sm font-medium"></p>
                </div>
            </form>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            // !!! IMPORTANT: This should be your actual Make.com webhook URL !!!
            const WEBHOOK_URL = 'https://hook.us2.make.com/mryq3zqwv5c4hlabyko7o6326395myoq'; 

            // --- CONSTANTS ---
            const PRODUCTS = ['Signature Chocolate Cake', 'Red Velvet Delight', 'Classic Vanilla Bean', 'Custom Themed Cake', 'Cupcake Box (12pcs)'];
            const FLAVOURS = ['Chocolate', 'Vanilla', 'Banana', 'Red Velvet', 'Strawberry', 'Lemon'];
            const SIZES = ['Small', 'Medium', 'Large'];
            const TIME_SLOTS = ['10am - 2pm', '2pm - 6pm', '6pm - 10pm', 'Other'];
            const SOURCES = ['Social Media', 'Friend/Family', 'Referral', 'Website', 'Google Search', 'Walk-in', 'Other'];
            const NUMBER_OPTIONS = (max, start = 0) => Array.from({ length: max - start + 1 }, (_, i) => i + start);

            // --- DOM ELEMENTS ---
            const form = document.getElementById('order-form');
            const orderItemsContainer = document.getElementById('order-items-container');
            const addOrderItemBtn = document.getElementById('add-order-item-btn');
            const submitBtn = document.getElementById('submit-btn');
            const submissionStatus = document.getElementById('submission-status');
            
            // --- STATE ---
            let itemCount = 0;

            // --- HELPERS ---
            const createSelectHTML = (name, options, selectedValue = '', label, id) => {
                const optionsHTML = options.map(opt => `<option value="${opt}" ${opt === selectedValue ? 'selected' : ''}>${opt}</option>`).join('');
                return `
                    <div>
                        <label for="${id}" class="block text-sm font-medium text-slate-600 mb-1">${label}</label>
                        <select id="${id}" name="${name}" class="form-input">${optionsHTML}</select>
                    </div>
                `;
            };

            const createOrderItemHTML = (id) => {
                const candleOptions = NUMBER_OPTIONS(50);
                const unitOptions = NUMBER_OPTIONS(10, 1);
                return `
                    <div class="order-item-row p-4 border border-slate-200 rounded-lg bg-slate-50 relative" data-id="${id}">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            ${createSelectHTML('product', PRODUCTS, PRODUCTS[0], 'Product', `product-${id}`)}
                            ${createSelectHTML('size', SIZES, SIZES[1], 'Size', `size-${id}`)}
                            ${createSelectHTML('flavour', FLAVOURS, FLAVOURS[0], 'Flavour', `flavour-${id}`)}
                            <div class="flex items-end pb-2">
                                <div class="flex items-center h-full mt-1">
                                    <input id="eggless-${id}" name="eggless" type="checkbox" class="h-5 w-5 text-sky-600 border-slate-300 rounded focus:ring-sky-500">
                                    <label for="eggless-${id}" class="ml-2 text-sm text-slate-600">Eggless</label>
                                </div>
                            </div>
                            ${createSelectHTML('candles', candleOptions, 0, 'Candles', `candles-${id}`)}
                            ${createSelectHTML('units', unitOptions, 1, 'Units', `units-${id}`)}
                            <div class="sm:col-span-2 md:col-span-3 lg:col-span-2">
                                <label for="greeting-${id}" class="block text-sm font-medium text-slate-600 mb-1">Greeting Message</label>

                                <input id="greeting-${id}" name="greeting" type="text" value="" placeholder="e.g., Happy Birthday!" class="form-input">
                            </div>
                        </div>
                        <button type="button" class="remove-item-btn absolute top-2 right-2 text-slate-400 hover:text-red-500 transition-colors" aria-label="Remove item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </button>
                    </div>
                `;
            };
            
            const createRadioGroup = (containerId, name, options, otherInputId) => {
                const container = document.getElementById(containerId);
                const otherInput = document.getElementById(otherInputId);
                options.forEach(option => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center';
                    div.innerHTML = `
                        <input id="${name}-${option.replace(/[\s/]/g, '-')}" name="${name}" type="radio" value="${option}" class="form-radio" ${options.indexOf(option) === 0 ? 'checked' : ''}>
                        <label for="${name}-${option.replace(/[\s/]/g, '-')}" class="ml-3 block text-sm font-medium text-slate-700">${option}</label>
                    `;
                    container.appendChild(div);
                });
                container.addEventListener('change', e => {
                    if (e.target.name === name) {
                        if (e.target.value === 'Other') {
                            otherInput.classList.remove('hidden');
                            otherInput.required = true;
                        } else {
                            otherInput.classList.add('hidden');
                            otherInput.required = false;
                            otherInput.value = '';
                        }
                    }
                });
            };

            const updateRemoveButtons = () => {
                const buttons = document.querySelectorAll('.remove-item-btn');
                buttons.forEach(btn => {
                    btn.style.display = itemCount > 1 ? 'block' : 'none';
                });
            };
            
            const addOrderItem = () => {
                itemCount++;
                const id = crypto.randomUUID();
                const itemHTML = createOrderItemHTML(id);
                orderItemsContainer.insertAdjacentHTML('beforeend', itemHTML);
                updateRemoveButtons();
            };

            const removeOrderItem = (id) => {
                if (itemCount <= 1) return;
                itemCount--;
                document.querySelector(`.order-item-row[data-id="${id}"]`).remove();
                updateRemoveButtons();
            };
            
            const resetForm = () => {
                form.reset();
                document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
                orderItemsContainer.innerHTML = '';
                addOrderItem();
                 // Reset radio groups to default
                document.querySelector('input[name="deliveryTimeSlot"]').checked = true;
                document.querySelector('input[name="source"]').checked = true;
                document.getElementById('otherTimeSlot').classList.add('hidden');
                document.getElementById('otherSource').classList.add('hidden');
                document.getElementById('otherTimeSlot').required = false;
                document.getElementById('otherSource').required = false;

            };

            // --- INITIALIZATION ---
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            createRadioGroup('deliveryTimeSlot-group', 'deliveryTimeSlot', TIME_SLOTS, 'otherTimeSlot');
            createRadioGroup('source-group', 'source', SOURCES, 'otherSource');
            addOrderItem();

            // --- EVENT LISTENERS ---
            addOrderItemBtn.addEventListener('click', addOrderItem);

            orderItemsContainer.addEventListener('click', e => {
                if (e.target.closest('.remove-item-btn')) {
                    const id = e.target.closest('.order-item-row').dataset.id;
                    removeOrderItem(id);
                }
            });
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                if (WEBHOOK_URL.includes('YOUR_MAKE_COM_WEBHOOK_URL_HERE')) {
                    submissionStatus.textContent = 'Please update Webhook URL!';
                    submissionStatus.className = 'ml-4 flex items-center text-sm font-medium text-red-600';
                    return;
                }
                
                const originalBtnText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
                submissionStatus.textContent = '';


                const formData = new FormData(form);
                const data = {};
                
                // Manually process form data to handle radio buttons and text fields correctly
                for (const [key, value] of formData.entries()) {
                    if (key === 'deliveryTimeSlot' && value === 'Other') {
                        data[key] = formData.get('otherTimeSlot');
                    } else if (key === 'source' && value === 'Other') {
                        data[key] = formData.get('otherSource');
                    } else if (key !== 'otherTimeSlot' && key !== 'otherSource') {
                       if (data[key]) {
                          if (!Array.isArray(data[key])) {
                            data[key] = [data[key]];
                          }
                          data[key].push(value);
                        } else {
                          data[key] = value;
                        }
                    }
                }

                data.orders = Array.from(document.querySelectorAll('.order-item-row')).map(row => ({
                    id: row.dataset.id,
                    product: row.querySelector('select[name="product"]').value,
                    size: row.querySelector('select[name="size"]').value,
                    flavour: row.querySelector('select[name="flavour"]').value,
                    eggless: row.querySelector('input[name="eggless"]').checked,
                    candles: parseInt(row.querySelector('select[name="candles"]').value, 10),
                    units: parseInt(row.querySelector('select[name="units"]').value, 10),
                    greeting: row.querySelector('input[name="greeting"]').value,
                }));

                // Remove fields that are now part of 'orders'
                delete data.product;
                delete data.size;
                delete data.flavour;
                delete data.eggless;
                delete data.candles;
                delete data.units;
                delete data.greeting;

                try {
                    const response = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error(`Server responded with ${response.status}: ${response.statusText}`);
                    }
                    
                    submitBtn.textContent = 'Submitted!';
                    submitBtn.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                    submitBtn.classList.add('bg-green-600');
                    submissionStatus.textContent = 'Order submitted successfully!';
                    submissionStatus.className = 'ml-4 flex items-center text-sm font-medium text-green-600';
                    
                    resetForm();

                } catch (error) {
                    console.error('Submission Error:', error);
                    submitBtn.textContent = 'Failed!';
                    submitBtn.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                    submitBtn.classList.add('bg-red-600');
                    submissionStatus.textContent = 'Submission Error. Please try again.';
                    submissionStatus.className = 'ml-4 flex items-center text-sm font-medium text-red-600';
                } finally {
                    setTimeout(() => {
                        submitBtn.textContent = originalBtnText;
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('opacity-75', 'cursor-not-allowed', 'bg-green-600', 'bg-red-600');
                        submitBtn.classList.add('bg-sky-600', 'hover:bg-sky-700');
                        submissionStatus.textContent = '';
                    }, 3000);
                }
            });
        });
    </script>
</body>
</html>
